!function(p,t){var i,e,o,r=!/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent),h=(i=p,e=t,o=r,s.prototype.attach=function(){this.$elem.wrap(this.$wrapper),this.$cropper.insertAfter(this.$elem),this.$wrapper=this.$elem.parent(),void 0!==e&&(this.hammertime||(this.hammertime=new e.Manager(this.$cropper[0]),this.hammertime.add(new e.Pan({direction:e.DIRECTION_ALL,treshhold:0})),this.hammertime.on("pan panstart panend",i.proxy(function(t){t.srcEvent.stopPropagation(),t.srcEvent.preventDefault(),"panstart"===t.type?(this.disableDesktopEvents(),this.onTouch(t)):"pan"===t.type?this.onDragOrResize(t):(this.onRelease(t),this.enableDesktopEvents())},this))),this.enableDesktopEvents())},s.prototype.detach=function(){this.$cropper.detach(),this.$elem.parent().is(this.$wrapper)&&this.$elem.unwrap()},s.prototype.measure=function(){var t=this.$elem,e=this.$wrapper[0],r=this.$cropper.position();return{imageWidth:t.width(),imageHeight:t.height(),wrapperTop:e.scrollTop,wrapperLeft:e.scrollLeft,wrapperWidth:this.$wrapper.width(),wrapperHeight:this.$wrapper.height(),cropperTop:r.top+e.scrollTop,cropperLeft:r.left+e.scrollLeft,cropperWidth:this.$cropper.outerWidth(),cropperHeight:this.$cropper.outerHeight()}},s.prototype.getPointerPosition=function(t,e){var r=this.$cropper.offset();return{top:e-r.top+this.$wnd.scrollTop(),left:t-r.left+this.$wnd.scrollLeft()}},s.prototype.getResizeDirection=function(t){var e=o?15:20,r=this.getPointerPosition(t.center.x,t.center.y),p=this.measurements,t="";return r.top<e?t+="n":r.top>p.cropperHeight-e&&(t+="s"),r.left<e?t+="w":r.left>p.cropperWidth-e&&(t+="e"),t},s.prototype.getSelection=function(){return{x:this.measurements.cropperLeft,y:this.measurements.cropperTop,width:this.measurements.cropperWidth,height:this.measurements.cropperHeight}},s.prototype.onTouch=function(t){this.released=!1,this.measurements=this.measure(),this.direction=this.getResizeDirection(t)},s.prototype.onDragOrResize=_.throttle(function(t){this.direction?this.onResize(t):this.onDrag(t)},o?10:100),s.prototype.onDrag=function(t){var e=this.measurements,r=t.deltaY,t=t.deltaX;this.released||(t=Math.min(t,e.imageWidth-e.cropperWidth-e.cropperLeft),t=Math.max(t,0-e.cropperLeft),r=Math.min(r,e.imageHeight-e.cropperHeight-e.cropperTop),r=Math.max(r,0-e.cropperTop),this.$cropper.css({webkitTransform:r="translate3d("+t+"px, "+r+"px, 0)",mozTransform:r,transform:r}))},s.prototype.onResize=function(t){var e=this.direction,r=this.measurements,p={};this.released||(e.match(/n/)?(p.top="auto",p.bottom=r.wrapperHeight-r.cropperTop-r.cropperHeight,p.height=r.cropperHeight-t.deltaY):e.match(/s/)&&(p.bottom="auto",p.top=r.cropperTop,p.height=r.cropperHeight+t.deltaY),e.match(/e/)?(p.right="auto",p.left=r.cropperLeft,p.width=r.cropperWidth+t.deltaX):e.match(/w/)&&(p.left="auto",p.right=r.wrapperWidth-r.cropperLeft-r.cropperWidth,p.width=r.cropperWidth-t.deltaX),p.width=p.height=Math.max(p.width||0,p.height||0,64),e.match(/n/)?p.height=Math.min(p.height,r.wrapperHeight-p.bottom):e.match(/s/)?p.height=Math.min(p.height,r.imageHeight-p.top):"auto"!==this.$cropper[0].style.top?p.height=Math.min(p.height,r.imageHeight-parseInt(this.$cropper.css("top"))):p.height=Math.min(p.height,r.wrapperHeight-parseInt(this.$cropper.css("bottom"))),e.match(/e/)?p.width=Math.min(p.width,r.imageWidth-p.left):e.match(/w/)?p.width=Math.min(p.width,r.wrapperWidth-p.right):"auto"!==this.$cropper[0].style.left?p.width=Math.min(p.width,r.imageWidth-parseInt(this.$cropper.css("left"))):p.width=Math.min(p.width,r.wrapperWidth-parseInt(this.$cropper.css("right"))),p.width=p.height=Math.min(p.width,p.height),this.$cropper.css(p))},s.prototype.onRelease=function(t){var e=this.$cropper.position(),r=this.measurements,r={top:Math.max(e.top+r.wrapperTop,0),left:Math.max(e.left+r.wrapperLeft,0),right:"",bottom:"",webkitTransform:"",mozTransform:"",transform:""};this.released=!0,this.$cropper.css(r),this.measurements=this.measure(),this.change(this.getSelection())},s.prototype.destroy=function(){this.detach(),this.$elem=null,this.$wrapper=null,this.$cropper=null,this.$wnd=null,this.hammertime=null},s.prototype.enableDesktopEvents=function(){o&&this.$cropper.on("mousemove.ps-crop",i.proxy(this.onMouseMove,this))},s.prototype.disableDesktopEvents=function(){o&&this.$cropper.off("mousemove.ps-crop")},s.prototype.onMouseMove=function(t){var e=i(t.target).parent().offset(),r=t.pageX-e.left,p=t.pageY-e.top,t="",e=this.measure();p<e.cropperTop-e.wrapperTop+15?t+="n":p>e.cropperTop-e.wrapperTop+e.cropperHeight-15&&(t+="s"),r<e.cropperLeft-e.wrapperLeft+15?t+="w":r>e.cropperLeft-e.wrapperLeft+e.cropperWidth-15&&(t+="e"),this.$cropper.css({cursor:t?t+"-resize":""})},s);function s(t){this.$elem=i(t.elem),this.$wrapper=i('<div class="ps-crop-wrapper" />'),this.$cropper=i('<div class="ps-crop-box" />'),this.$wnd=i(window),this.change=t.change||i.noop,this.attach(),this.measurements=this.measure(),this.change(this.getSelection())}ps_crop={init:function(t){var e=p(t.elem),r=e.data("ps-crop");r&&r.destroy(),r=new h(t),e.data("ps-crop",r)},detach:function(t){(t=(t=p(t)).data("ps-crop"))&&t.detach()}}}(jQuery||$,window.Hammer,peepso);