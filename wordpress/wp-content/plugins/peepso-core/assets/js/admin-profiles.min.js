!function(f){var s,e=f(".ps-js-fields-container");e.on("input",".ps-js-field input[type=text]",function(){f(this).closest(".ps-js-fieldconf").find(".ps-js-btn").show()}).on("keydown",".ps-js-field input[type=text]",function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),f(this).closest(".ps-js-fieldconf").find(".ps-js-save").click())}).find(".ps-js-field input[type=text]").each(function(){f(this).data("original-value",this.value)}),e.on("click",".ps-js-field .ps-js-cancel",function(){var e=f(this).closest(".ps-js-fieldconf"),t=e.find(".ps-js-btn"),e=e.find("input[type=text]");t.hide(),e.val(e.data("original-value"))}),e.on("click",".ps-js-field .ps-js-save",function(){var e=f(this).closest(".ps-js-fieldconf"),t=e.find(".ps-js-btn"),s=e.find("input[type=text]"),a=e.find(".ps-js-progress"),i="adminConfigFields.set_"+("meta"===s.data("prop-type")?"meta":"prop"),o={id:s.data("parent-id")||void 0,prop:s.data("prop-name")||void 0,key:s.data("prop-key")||void 0,value:s.val()};if("validation"===o.prop){var n,d,l=o.key.match(/^[a-z]+(min|max)_value$/),p=!1;if(l&&(""===o.value.trim()||isNaN(o.value)||+o.value<0?p=peepsoadminprofilesdata.number_invalid:(d=o.key.replace(l[1],"min"===l[1]?"max":"min"),e=(n=e.closest(".ps-tab__content")).find('[data-prop-key="'+d+'"]'),n.find('[data-prop-key="'+d.replace("_value","")+'"]')[0].checked&&(e=e.data("original-value")||e.val(),"min"===l[1]&&+e<+o.value?p=(p=peepsoadminprofilesdata.min_invalid).replace(/%d/g,+e):"max"===l[1]&&+e>+o.value&&(p=(p=peepsoadminprofilesdata.max_invalid).replace(/%d/g,+e))))),p)return void alert(p)}a.find("img").show(),s.attr("readonly","readonly"),peepso.postJson(i,o,function(e){a.find("img").hide(),a.find("i").show().delay(800).fadeOut(),s.removeAttr("readonly"),e.success&&(t.hide(),s.data("original-value",o.value),"post_title"==s.data("prop-name")&&f("#field-"+o.id+"-box-title").html(o.value))})}),e.on("click","input[type=checkbox]",_.throttle(function(){var e,t,s,a,i,o,n=f(this),d=n.closest(".ps-js-fieldconf").find(".ps-js-progress"),l=n[0].checked,p=!1,r="adminConfigFields.set_"+("meta"===n.data("prop-type")?"meta":"prop"),c={id:n.data("parent-id")||void 0,prop:n.data("prop-name")||void 0,key:n.data("prop-key")||void 0,value:l?n.val():n.data("disabled-value")};!l||"validation"!==c.prop||(e=c.key.match(/^[a-z]+(min|max)$/))&&(i=c.key.replace(e[1],"min"===e[1]?"max":"min"),a=(t=n.closest(".ps-tab__content")).find('[data-prop-key="'+i+'"]'),i=t.find('[data-prop-key="'+i+'_value"]'),a[0].checked&&(o=i.data("original-value")||i.val(),("min"===e[1]&&+o<+c.value||"max"===e[1]&&+o>+c.value)&&(p=!0)),p&&(t=t.find('[data-prop-key="'+c.key+'_value"]'),s=t.nextAll(".ps-js-save"),t.val(o))),d.find("i").stop().hide(),d.find("img").show(),n.attr("readonly","readonly"),peepso.postJson(r,c,function(e){d.find("img").hide(),d.find("i").show().delay(800).fadeOut(),n.removeAttr("readonly"),e.success&&(p&&s.trigger("click"),$value_container_id="#"+n[0].id+"-value-container",$container_id="#"+n[0].id+"-container",l?f($value_container_id).fadeIn(500):f($value_container_id).fadeOut(500),"validation"===c.prop&&"required"===c.key?(e=f("#field-"+c.id+"-required-mark"),l?e.removeClass("hidden"):e.addClass("hidden")):"post_status"===c.prop&&(l?n.closest(".postbox").removeClass("postbox-muted"):n.closest(".postbox").addClass("postbox-muted")))})},1e3)),e.on("change","select",_.throttle(function(){var t=f(this),s=t.closest(".ps-js-fieldconf").find(".ps-js-progress"),e="adminConfigFields.set_"+("meta"===t.data("prop-type")?"meta":"prop"),a={id:t.data("parent-id")||void 0,prop:t.data("prop-name")||void 0,key:t.data("prop-key")||void 0,value:t.val()};s.find("i").stop().hide(),s.find("img").show(),t.attr("readonly","readonly"),peepso.postJson(e,a,function(e){s.find("img").hide(),s.find("i").show().delay(800).fadeOut(),t.removeAttr("readonly"),e.success})},1e3)),e.sortable({handle:".ps-js-handle",update:_.throttle(function(){var e=[];f(".ps-js-fields-container .postbox").each(function(){e.push(f(this).data("id"))}),peepso.postJson("adminConfigFields.set_order",{fields:JSON.stringify(e)},function(e){})},3e3)}),e.on("click",".ps-js-field-toggle",function(){var e=f(this),t=e.closest(".postbox"),s=t.find(".ps-js-field"),a=t.data("id");s.is(":visible")?s.slideUp("fast",function(){e.removeClass("fa-compress").addClass("fa-expand"),i(),o(a,0)}):s.slideDown("fast",function(){e.removeClass("fa-expand").addClass("fa-compress"),i(),o(a,1)})}),e.on("click",".ps-js-field-title",function(e){e.target===e.currentTarget&&f(this).closest(".ps-postbox__title").find(".ps-js-field-toggle").click()}),e.on("mousedown",".ps-postbox__title",function(e){var t=f(e.currentTarget);s=setTimeout(function(){t.addClass("ps-js-mousedown")},200)}).on("mouseup mouseleave",".ps-postbox__title",function(e){clearTimeout(s),f(e.currentTarget).removeClass("ps-js-mousedown")}),f(".ps-js-field-expand-all").on("click",function(){e.find(".ps-js-field").slideDown("fast",function(){t(1)})}),f(".ps-js-field-collapse-all").on("click",function(){e.find(".ps-js-field").slideUp("fast",function(){t(0)})});var t=_.debounce(function(e){var t=f(".ps-js-fields-container").children(".postbox");0===e?t.find(".ps-js-field-toggle").removeClass("fa-compress").addClass("fa-expand"):t.find(".ps-js-field-toggle").removeClass("fa-expand").addClass("fa-compress"),i(e),o("all",e)},200);function i(e){var t,s,a=f(".ps-js-field-toggle-all"),i=a.find("span").first(),o=a.find("span").last();void 0===e&&(e=s=t=0,f(".ps-js-fields-container").find(".ps-js-field").each(function(){t++,f(this).is(":visible")&&s++}),t<=s&&(e=1)),0==+e?(a.data("status",0),o.html(a.data("expand-text")),i.removeClass("fa-compress").addClass("fa-expand")):(a.data("status",1),o.html(a.data("collapse-text")),i.removeClass("fa-expand").addClass("fa-compress"))}i();var a={},o=_.debounce(function(e,t){var s=[];"all"!==e?s=[e]:f(".ps-js-fields-container").children(".postbox").each(function(){s.push(f(this).data("id"))}),a[e]&&a[e].ret&&a[e].ret.abort(),a[e]=peepso.postJson("adminConfigFields.set_admin_box_status",{id:JSON.stringify(s),status:t},function(e){})},500);f(".ps-js-field-new").on("click",function(){var t,e="no-plugin-warning",s=f("#"+e);s.length||(t=window.peepsoadminprofilesdata||{},(s=f(t.popup_template)).prop("id",e),s.appendTo(document.body),s.on("click",".button-link",function(){s.hide()}),s.on("click",".button-primary",function(e){e.preventDefault(),e.stopPropagation(),s.hide(),window.open(t.plugin_url)})),s.show()}),e.on("click",".ps-tabs a",function(){var e=f(this),t=e.closest(".ps-tabs").find(".active");return t.removeClass("active"),e.addClass("active"),f(t.attr("href")).hide(),f(e.attr("href")).show(),!1}),e.on("click",".ps-postbox__title .fa-edit",function(){var e=f(this).closest(".ps-postbox__title"),t=e.find(".ps-postbox__title-label"),s=e.find(".ps-postbox__title-editor"),a=s.find("input[type=text]"),i=(a.nextAll(".ps-js-save"),a.data("prop-title-is-default")),e=a.val();t.hide(),s.show(),a.data("original-value",e).focus(),a.val(i?"":e).trigger("input")}),e.on("click",".ps-js-field-title-text",function(){f(this).closest(".ps-postbox__title").find(".fa-edit").click()}),e.on("click",".ps-postbox__title .ps-js-cancel",function(){var e=f(this).closest(".ps-postbox__title"),t=e.find(".ps-postbox__title-label"),s=e.find(".ps-postbox__title-editor"),e=s.find("input[type=text]");e.val(e.data("original-value")),s.hide(),t.show()}),e.on("click",".ps-postbox__title .ps-js-save",function(){var e=f(this).closest(".ps-postbox__title"),t=e.find(".ps-postbox__title-label"),s=e.find(".ps-postbox__title-editor"),a=s.find("input[type=text]"),i=e.find(".ps-js-progress"),e="adminConfigFields.set_"+("meta"===a.data("prop-type")?"meta":"prop"),o={id:a.data("parent-id")||void 0,prop:a.data("prop-name")||void 0,key:a.data("prop-key")||void 0,value:a.val()};i.find("img").show(),a.attr("readonly","readonly"),peepso.postJson(e,o,function(e){i.find("img").hide(),i.find("i").show().delay(800).fadeOut(),a.removeAttr("readonly"),e.success&&(s.hide(),t.show(),a.data("original-value",o.value),a.data("prop-title-is-default",!1),f("#field-"+o.id+"-box-title").html(o.value))})}),e.on("keydown",".ps-postbox__title input[type=text]",function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),f(this).nextAll(".ps-js-save").click())}).on("input",".ps-postbox__title input[type=text]",function(e){var t=f(this).nextAll(".ps-js-save");this.value.trim()?t.removeAttr("disabled"):t.attr("disabled","disabled")}),e.on("focus",".ps-js-focusguard",function(){var e=f(this),t=e.closest(".ps-js-options").children(".ps-js-fieldconf");("last"===e.data("tag")?t.find("input").first():t.find("input").last()).focus()}),e.on("change","select[data-prop-name=date_range_min]",function(e){var t=f(this),s=t.closest(".ps-tab__content").find("select[data-prop-name=date_range_max]");+s.val()<+t.val()&&s.val(t.val()).trigger("change")}),e.on("change","select[data-prop-name=date_range_max]",function(e){var t=f(this),s=t.closest(".ps-tab__content").find("select[data-prop-name=date_range_min]");+s.val()>+t.val()&&s.val(t.val()).trigger("change")}),f(function(){f(".ps-settings__bar").addClass("ps-settings__bar--static"),f(window).scroll(function(){var e=f(".ps-settings__bar");50<f(this).scrollTop()?e.removeClass("ps-settings__bar--static"):e.addClass("ps-settings__bar--static")})})}(jQuery);